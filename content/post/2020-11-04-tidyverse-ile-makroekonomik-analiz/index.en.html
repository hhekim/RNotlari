---
title: tidyverse ile makroekonomik analiz
author: Hakan Hekim
date: '2020-11-04'
slug: tidyverse-ile-makroekonomik-analiz
categories:
  - Grafik
tags:
  - ggplot2
  - tidyverse
description: tidyverse ve ameco paketlerini kullanarak makroekonomik analiz.
featured: no
#toc: no
#featureImage: /images/path/file.jpg
thumbnail: /images/thumbs/tidyverse_tn.jpg
shareImage: /logos/slogo.jpeg
codeMaxLines: 10
codeLineNumbers: no
figurePositionShow: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<p>Bu yazıda <code>tidyverse</code> paketini kullanacağım. <code>tidyverse</code> aslında tek bir paket olmayıp, birçok paketi barındıran bir tür paketler paketi. İçerisinde <code>ggplot2</code>, <code>dplyr</code>, <code>readr</code>, <code>tidyr</code> gibi sık kullanılan paketler bulunmaktadır. Dolayısıyla bu mütevazi notta %5’inin bile anlatılması zor olup sadece <code>%&gt;%</code> operatörü ve <code>filter()</code> fonksiyonunu kullanarak paketin sağladığı kolaylıkların ne menem bir şey olduğuna işaret etmeye çalışacağım.</p>
<p>Bilindiği üzere R sistemi (base hariç) dünyanın dört bir yanında yaşayan gönüllülerce geliştirilmektedir. Bu özelliği R’a dinamizm ve zenginlik katmaktadır. İhtiyaç duyabileceğimiz bir paketin birileri tarafından zaten geliştirilmiş olması yüksek ihtimale sahiptir. CRAN sayfasında 6.000’in üzerinde paket bulunmaktadır. Ancak bu durumun olumsuz tarafı R paketlerinde (hatta kısmen base paketinde bile) standart bir dilin tutturalamamış olmasıdır. Bu özellik (fark etsek de, fark etmesek de) hata mesajları olarak sıkça karşımıza çıkmakta. Bu sebeple etkin R kullanımı için veri yapılarının, fonksiyonların ve bunlara ilişkin istisnai durumların inceliklerine hakim olmamız gerekmektedir.</p>
<p>İşte <code>tidyverse</code> bu olumsuzluğun önüne geçmek ve verisetlerinin manipülasyonunda standart bir dil kullanabilmek ve hatta kolaylaştırmak amacıyla üretilmiş. “Ben zaten standart R gramerine ve fonksiyonlarına hakimim, her tür işlemi gözüm kapalı yapıyorum” diyorsanız bile <code>tidyverse</code> işlemlerinizi hızlandıracaktır. Temel R diliyle uzun kod satırları gerektiren bazı işlemler <code>tidyverse</code> ile daha az kodla yapılabilir. Bu sebeple ortalamanın üstü kullanıcıların da <code>tidyverse</code> paketine bir göz atmalarında fayda var.</p>
<p>Bu yazıda <code>tidyverse</code> paketini, CRAN üzerinden indirebileceğimiz <code>ameco</code> verisetiyle birlikte kullanacağım. <code>ameco</code> Avrupa Komisyonunca derlenen makroekonomik verileri içeren bir verisetidir. Genellikle 1960’lardan başlayan zaman serisi tarzı veriler içermektedir. Ekonomik haberlerin gündemin üst sıralarında olduğu bu dönemde bazı makroekonomik verilere grafikler yardımıyla bir bakalım.</p>
<pre class="r"><code>library(tidyverse)
library(ameco)</code></pre>
<p>İlk olarak başımızın belası olan dış ticaret açığının tarihi seyrini inceleyeceğim. Bunun için ameco verisetini filtreleyerek Türkiyeye ait ithalat ve ihracat rakamlarını (2010 fiyatlarıyla) içeren yeni bir veriseti oluşturacağım:</p>
<pre class="r"><code>exim &lt;- ameco %&gt;% 
  filter((sub.chapter == &quot;01 Exports of goods and services&quot; | 
            sub.chapter == &quot;02 Imports of goods and services&quot;) &amp; 
           (title == &quot;Exports of goods and services at 2010 prices&quot; | 
              title ==&quot;Imports of goods and services at 2010 prices&quot;) &amp; 
           (cntry == &quot;TUR&quot;))</code></pre>
<p>Burada pipe olarak adlandırılan <code>%&gt;%</code> operatörünü kulandık. <code>%&gt;%</code> operatörü ile bir önceki kodun çıktısının, bir sonraki kod için girdi olarak kullanılabildiği iç içe kod yazarak kod yazımını ve bellek kullanımını azaltabiliriz.</p>
<p>Şimdi bu alt verisetiyle ithalat ve ihracatın seyrine grafikle bakabiliriz:</p>
<pre class="r"><code>ggplot(exim, aes(year, value, color=sub.chapter)) +
  guides(color = guide_legend(title=NULL)) +
  scale_color_discrete(labels = c(&quot;İhracat&quot;,&quot;Ithalat&quot;)) +
  geom_freqpoly(stat = &quot;identity&quot;) +
  xlab(NULL) + ylab(&quot;2010 fiyatlarıyla miktar&quot;)</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>R’ın standart grafiklerini sevenler için aynı grafik şu şekilde çizilebilir:</p>
<pre class="r"><code>plot(exim$value[exim$sub.chapter == &quot;02 Imports of goods and services&quot;]
     ~exim$year[exim$sub.chapter == &quot;02 Imports of goods and services&quot;],
     type = &quot;l&quot;,xlab=&quot;&quot;,ylab = &quot;2010 fiyatlarıyla miktar&quot;)
x &lt;- exim$value[exim$sub.chapter == &quot;01 Exports of goods and services&quot;]
y &lt;- exim$year[exim$sub.chapter == &quot;01 Exports of goods and services&quot;]
lines(x~y,lty=2)
legend(1960,400, c(&quot;ithalat&quot;, &quot;ihracat&quot;), lty = c(1,2))</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Görüldüğü gibi özellikle 2001 ekonomik krizinin ardından ithalat rakamları ihracatı geçmeye başlamış, 2007-2008 yılında birbirlerine yaklaşmış ancak sonrasında makas tekrar açılmış.</p>
<p>Ticaret hacmine göre ülkelerin durumunu karşılaştırmak için öncelikle ilgili alt verisetini üretelim:</p>
<pre class="r"><code>ftrade &lt;- ameco %&gt;% 
  filter(sub.chapter == &quot;02 Foreign trade shares in world trade&quot; &amp; 
           title == &quot;Average share of imports and exports of goods in world trade including intra EU trade :- Foreign trade statistics&quot; &amp; 
           cntry != &quot;EU28&quot; &amp; cntry != &quot;EU15&quot; &amp; cntry != &quot;EA19&quot; &amp; 
           cntry != &quot;EA12&quot; &amp; cntry != &quot;DU15&quot; &amp; cntry != &quot;DA12&quot;)</code></pre>
<p>Ülkelerin ticaret hacmini zaman serisi olarak karşılaştırmak zor çünkü verisetinde 43 farklı ülke var. Bunun yerine mevcut verilerin ortalamalarını alıp büyükten küçüğe sıralanmış grafiğini çizeceğim:</p>
<pre class="r"><code>by_value &lt;- group_by(ftrade, cntry)
by_avrg &lt;- summarise(by_value, avrg = mean(value, na.rm = T))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>by_avrg &lt;- arrange(by_avrg,avrg)
by_avrg &lt;- by_avrg[by_avrg$cntry != &quot;D&quot;,]

ggplot(by_avrg,aes(x=avrg,y=reorder(cntry,avrg))) +
  geom_point() +xlab(NULL) + ylab(NULL) +
  theme_bw()</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>ABD, Almanya, Japonya, İngiltere ve Fransa başı çekerken Türkiye ortalarda bulunmaktadır.</p>
<p>Sektörlere göre işgücü rakamlarını hesaplamak için yine alt verisetini üretiyoruz ve grafik başlıklarını Türkçeleştirmek için (maalesef) değişkenleri yeniden isimlendiriyoruz:</p>
<pre class="r"><code>emplymnt &lt;- ameco %&gt;% 
  filter(sub.chapter == &quot;01 Employment, persons&quot; &amp; 
           cntry == &quot;TUR&quot; &amp; year &gt;= 2003 &amp; year &lt; 2013) 
emplymnt1 &lt;- emplymnt 
emplymnt1$title[emplymnt1$title == &quot;Employment, persons: agriculture, forestry and fishery products (National accounts)&quot;] &lt;- &quot;Tarım, orman ve balıkçılık&quot; 
emplymnt1$title[emplymnt1$title == &quot;Employment, persons: industry excluding building and construction (National accounts)&quot;] &lt;- &quot;Sanayi&quot; 
emplymnt1$title[emplymnt1$title == &quot;Employment, persons: building and construction (National accounts)&quot;] &lt;- &quot;İnşaat&quot; 
emplymnt1$title[emplymnt1$title == &quot;Employment, persons: services (National accounts)&quot;] &lt;- &quot;Hizmetler&quot; 
emplymnt1$title[emplymnt1$title == &quot;Employment, persons: manufacturing industry (National accounts)&quot;] &lt;- &quot;İmalat&quot; 

ggplot(emplymnt1, aes(year, value)) + 
  geom_line() + 
  facet_wrap(~title, nrow = 3)</code></pre>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Mevcut işgücü istatistikleri hizmetler sektöründeki artışın dışında diğer sektörlerde belirgin bir farklılaşmanın olmadığını gösteriyor.</p>
<p>En önemli makroekonomik göstergelerden birisi de işsizlik oranları. Ülkemizde işsizliğin seyrine AB ülkeleriyle karşılaştırmalı olarak bakalım:</p>
<pre class="r"><code>unemp &lt;- ameco %&gt;% 
  filter(sub.chapter == &quot;03 Unemployment&quot; &amp;
           title == &quot;Unemployment rate: total :- Member States: definition EUROSTAT&quot;)
tur_eu_unemp &lt;- unemp %&gt;% 
  filter(cntry == &quot;TUR&quot; | cntry == &quot;DU15&quot; | cntry == &quot;EU15&quot; )

ggplot(tur_eu_unemp,aes(year,value,col=cntry)) + 
  geom_line() + 
  geom_point() + 
  xlab(NULL) + 
  ylab(NULL)</code></pre>
<pre><code>## Warning: Removed 58 row(s) containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 58 rows containing missing values (geom_point).</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Ekonomik kriz akabinde yeni sağın yükselişi ve yaygınlaşan özelleştirme politikalarının etkisiyle 75’ten itibaren Avrupa’da işsizlik 87’ye kadar yükselmekte ve sonrasında %6 ile %11 arasında dalgalı bir seyir izlemekte.</p>
<p>Ülkemizdeyse ilk dikkat çeken 1969 yılındaki sert düşüş. Bunun sebebi merak uyandırmakta… Sonrasında 75’ten itibaren yükselişe geçen işsizlik 80’lerde tekrar azalarak 2000’e kadar %6 ile %8 aralığında gerçekleşmiş. 2000’den sonra yükselişe geçerek tarihi seviyelerinden olan %13’leri bulmuş görünüyor.</p>
<p>İşsizlikle birlikte bir de tüketim alışkanlıklarını aynı biçimde karşılaştıralım:</p>
<pre class="r"><code>consump &lt;- ameco %&gt;% 
  filter(sub.chapter ==&quot;08 Total consumption&quot; &amp;
           title == &quot;Total consumption at 2010 prices&quot;)
tur_eu_consump &lt;- consump %&gt;% 
  filter(cntry == &quot;TUR&quot; | cntry == &quot;DU15&quot; | cntry == &quot;EU15&quot;)

ggplot(tur_eu_consump, aes(x=year, y=value, col=cntry)) +
  geom_line() + 
  xlab(NULL) + 
  ylab(NULL)</code></pre>
<pre><code>## Warning: Removed 136 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Toplam tüketim miktarı AB ülkelerinde dik bir eğimle artarken Türkiye’de nispeten daha istikrarlı bir artış gözlemlenmektedir. Türkiye’ye daha detaylı bakacak olursak:</p>
<pre class="r"><code>tur_consump &lt;- tur_eu_consump %&gt;% 
  filter(cntry == &quot;TUR&quot;)
ggplot(tur_consump, aes(x=year, y=value, col=cntry)) +
  geom_line() + 
  xlab(NULL) + 
  ylab(NULL)</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Görüleceği üzere 80’lerden itibaren tüketim hızımız hızlı bir biçimde artmıştır. Kriz dönemleirndeki yavaşlamalara rağmen ivme devam etmiştir.</p>
<p>Tüketime karşın üretim ne alemde? Üretimin önemli göstergelerinden GSMH verilerine bakalım:</p>
<pre class="r"><code>gdp_tur_eu &lt;- ameco %&gt;% 
  filter(sub.chapter ==&quot;01 Gross domestic product&quot; &amp; 
           title == &quot;Gross domestic product at current prices&quot; &amp; 
           (cntry == &quot;TUR&quot; | cntry == &quot;DU15&quot; | cntry == &quot;EU15&quot;) &amp; 
           (unit == &quot;Mrd ECU/EUR, Standard aggregation&quot; | unit == &quot;Mrd ECU/EUR&quot;) &amp; 
           code != &quot;EU15.1.0.0.0.UVGD&quot; &amp; code != &quot;DU15.1.0.0.0.UVGD&quot;) 
gdp_tur &lt;- gdp_tur_eu %&gt;% 
  filter( cntry == &quot;TUR&quot;) 

ggplot(gdp_tur, aes(x=year, y=value)) + 
  geom_line() + 
  geom_point() + 
  xlab(NULL) + 
  ylab(NULL)</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Ülkemizde 90’ların ortalarından itibaren GSMH’de önceki yıllara kıyasla daha hızlı artış olmuştur. Ancak bunu AB ülkeleriyle kıyasladığımızda ufak kaldığı görülecektir:</p>
<pre class="r"><code>ggplot(gdp_tur_eu,aes(x=year, y=value, col=cntry)) +
  geom_line() + 
  xlab(NULL) + 
  ylab(NULL)</code></pre>
<pre><code>## Warning: Removed 58 row(s) containing missing values (geom_path).</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Son olarak alacak verecek hesaplarını inceleyelim:</p>
<pre class="r"><code>balance_tur_eu &lt;- ameco %&gt;% 
  filter(sub.chapter ==&quot;01 Balances with the rest of the world, national accounts&quot; &amp;
           title == &quot;Net lending (+) or net borrowing (-): total economy&quot; &amp;
           (cntry == &quot;TUR&quot; | cntry == &quot;DU15&quot; | cntry == &quot;EU15&quot;) &amp;
           (unit == &quot;Mrd ECU/EUR, Standard aggregation&quot; | unit == &quot;Mrd ECU/EUR&quot;) &amp;
           year &gt; 2008 &amp; code != &quot;EU15.1.0.0.0.UBLA&quot;)
balance_tur_eu$np &lt;- balance_tur_eu$value &gt; 0

ggplot(balance_tur_eu, aes(year, value, fill = np)) +
  geom_bar(stat=&quot;identity&quot;, position = &quot;identity&quot;) +
  guides(fill = guide_legend(title=NULL)) +
  scale_fill_discrete(labels = c(&quot;Türkiye&quot;,&quot;EU&quot;)) +
  xlab(NULL) + ylab(NULL)</code></pre>
<p><img src="/post/2020-11-04-tidyverse-ile-makroekonomik-analiz/index.en_files/figure-html/unnamed-chunk-13-1.png" width="672" />
Ülkemiz alacak verecek hesabında borçtan kurtulamazken, AB ülkeleri pozitifte.</p>
<p>Yukarıdaki kodları satır satır izah etmedim. Üzerinden giderseniz kolay anlaşılacağını düşünüyorum.</p>
<p>Başlarken belirttiğim gibi, <code>tidyverse</code> büyük verisetlerinin manipülasyonu için kullanışlı araçlar içermekte. Böylelikle kod yazımını önemli ölçüde azaltıyor ve hata yapma ihtimalini de düşürüyor.</p>
